@page
@model OroIdentityServer.Server.Pages.ConsentModel
@{
    Layout = null;
}
@inject Microsoft.AspNetCore.Antiforgery.IAntiforgery Antiforgery
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Consent</title>
    <style>
        body { font-family: Arial, sans-serif; background:#f6f8fb; color:#111; }
        .card { background:white; max-width:700px; margin:48px auto; padding:24px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.08); }
        .header { display:flex; align-items:center; gap:12px; }
        .client { font-weight:700; font-size:1.1rem }
        .scopes { margin-top:12px; }
        .btn { padding:10px 16px; border-radius:6px; cursor:pointer; border:0 }
        .btn-approve{ background:#2563eb; color:white }
        .btn-deny{ background:#e6e7ea; color:#111 }
        .field { margin-top:12px }
        label{ display:block; font-size:0.9rem; margin-bottom:6px }
        input[type=text]{ width:100%; padding:8px; border:1px solid #d1d5db; border-radius:6px }
    </style>
</head>
<body>
    <div class="card">
        <div class="header">
            <div class="client">Authorize <strong>@Model.ClientId</strong></div>
        </div>

        @if (Model.AuthenticatedUser != null)
        {
            <div style="margin-bottom:12px;">Signed in as <strong>@Model.AuthenticatedUser.Email ?? Model.AuthenticatedUser.UserName</strong>
                <form method="post" asp-page-handler="Logout" style="display:inline; margin-left:8px">
                    <button class="btn btn-deny" type="submit">Sign out</button>
                </form>
            </div>
        }

        @if (Model.AuthenticatedUser == null)
        {
            <!-- Simple sign-in form that posts to the page handler to create the auth cookie -->
            <form method="post" asp-page-handler="Login" class="field">
                <label for="login-subject">Sign in (email)</label>
                <input id="login-subject" name="Subject" type="text" required placeholder="user@example.com" value="@Model.Subject" />
                <div style="margin-top:8px"><button class="btn btn-approve" type="submit">Sign in</button></div>
            </form>
        }

        <form method="post" asp-page-handler="Authorize">
            @* Anti-forgery token for the page handler *@
            <AntiforgeryToken />
            
            <input type="hidden" name="ApplicationId" value="@Model.ClientId" />
            <input type="hidden" name="Scope" value="@Model.Scope" />
            <input type="hidden" name="State" value="@Model.State" />
            <input type="hidden" name="CodeChallenge" value="@Model.CodeChallenge" />
            <input type="hidden" name="CodeChallengeMethod" value="@Model.CodeChallengeMethod" />
            <input type="hidden" name="Nonce" value="@Model.Nonce" />
            <input type="hidden" name="RedirectUri" value="@Model.RedirectUri" />

            <div class="field">
                <label for="subject">User (email)</label>
                <input id="subject" name="Subject" type="text" required placeholder="user@example.com" value="@Model.Subject" />
            </div>

            <div class="field">
                <label><input type="checkbox" name="Remember" value="true" /> Remember this decision</label>
            </div>

            @if (Model.ErrorMessage != null)
            {
                <div style="color:#b91c1c; margin-top:8px">@Model.ErrorMessage</div>
            }

            <div class="scopes">
                <label>Requested scopes:</label>
                <div>@Model.Scope</div>
            </div>

            <div style="margin-top:18px; display:flex; gap:8px;">
                <button class="btn btn-approve" type="submit">Approve</button>
                <a class="btn btn-deny" href="@Model.RedirectUri?error=access_denied&state=@Model.State">Deny</a>
            </div>
        </form>
    </div>
</body>
</html>
